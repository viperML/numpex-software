name: ci

on:
  push:
    branches:
      - master

jobs:
  main:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install fq
        run: |
          curl -OLs https://github.com/wader/fq/releases/download/v0.14.0/fq_0.14.0_linux_amd64.tar.gz
          tar -xzf fq*.tar.gz
          sudo install -Dm755 fq /usr/local/bin/fq

      - name: Convert YAML to JSON
        run: |
          fq -r . projects.yml > projects.json

      - name: Update or create latest release
        id: release
        uses: softprops/action-gh-release@v1
        with:
          name: Latest
          tag_name: latest
          files: projects.json
          body: "Auto-generated JSON from projects.yml"
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
