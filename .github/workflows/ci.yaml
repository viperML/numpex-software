name: ci

concurrency: ci

on:
  push:
    branches:
      - master

jobs:
  main:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install fq
        run: |
          curl -OLs https://github.com/wader/fq/releases/download/v0.14.0/fq_0.14.0_linux_amd64.tar.gz
          tar -xzf fq*.tar.gz
          sudo install -Dm755 fq /usr/local/bin/fq

      - name: Convert YAML to JSON
        run: |
          fq -r . projects.yml > projects.json

      - uses: ncipollo/release-action@v1
        name: Release
        with:
          tag: latest
          makeLatest: true
          omitBody: true
          omitName: true
          allowUpdates: true
          replacesArtifacts: true
          artifacts: projects.json
